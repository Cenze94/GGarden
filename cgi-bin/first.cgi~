#!/usr/bin/perl
use XML::LibXSLT;
use XML::LibXML;
use strict;
use warnings;
use HTML::TreeBuilder;

#Carico tutti i dati che mi servono, come i percorsi dei file xml
my $filexml = "../XML/database.xml";
my $filexslt = "../XML/database.xslt";
my $word="Zappetta a cuore";
my $xpath="prodotti/attrezzo[nome='Zappetta a cuore']";

#creo i parser che mi servono ed effettuo tutte le operazioni necessarie ad ottenere il file html
my $parserxml  = XML::LibXML->new;
my $parserxslt = XML::LibXSLT->new;

my $doc         = $parserxml->parse_file($filexml);
my $xslt         = $parserxml->parse_file($filexslt) || die("Operazione di parsificazione fallita");

#modifico il file in modo da selezionare solo i prodotti che mi interessano
my $node = $doc->findnodes("//attrezzo[nome='Zappetta a cuore']")->get_node(0);
my $father = $node->parentNode;
$father->removeChild($node);

#applico il foglio di stile al file modificato
my $stylesheet  = $parserxslt->parse_stylesheet($xslt);
my $results     = $stylesheet->transform_file($filexml);

my $fileToPrint = $stylesheet->output_as_bytes($results);
$stylesheet->output_file($results, "../search.html");

print "Content-type: text/html; charset=utf-8\n\n";
print "<phtml>";
print "<body>";
print $fileToPrint;
print "</body>";
print "</html>";
